name: Sync EPG to Gitee

on:
  schedule:
    - cron: '0 */6 * * *'
  workflow_dispatch:

jobs:
  sync-epg:
    runs-on: ubuntu-latest
    
    steps:
    - name: Download EPG file
      run: |
        echo "ğŸš€ å¼€å§‹åŒæ­¥EPGæ•°æ®..."
        curl -s -o swh123_epg.gz "https://epgcloud.swh123.top/epg.php?ch=xml&v=e2all&gz=1"
        FILE_SIZE=$(wc -c < swh123_epg.gz)
        echo "âœ… EPGæ–‡ä»¶ä¸‹è½½å®Œæˆ"
        echo "ğŸ“¦ æ–‡ä»¶å¤§å°: $FILE_SIZE å­—èŠ‚"
        
    - name: Update Gitee repository
      run: |
        echo "ğŸ”„ æ›´æ–°Giteeä»“åº“..."
        
        # å…‹éš†Giteeä»“åº“
        git clone https://shiwenhua:${{ secrets.GITEE_TOKEN }}@gitee.com/shiwenhua/epg-sync.git gitee-repo
        cd gitee-repo
        
        # å¤åˆ¶æ–‡ä»¶
        echo "ğŸ“ å¤åˆ¶æ–‡ä»¶åˆ°ä»“åº“..."
        cp ../swh123_epg.gz ./
        
        # é…ç½®Gitç”¨æˆ·
        git config user.email "epg-sync@bot.com"
        git config user.name "EPG Sync Bot"
        
        # æäº¤æ›´æ”¹
        echo "ğŸ’¾ æäº¤æ›´æ”¹..."
        git add swh123_epg.gz
        git commit -m "ğŸ¤– è‡ªåŠ¨åŒæ­¥EPGæ•°æ®: $(date -u +'%Y-%m-%d %H:%M:%S UTC')"
        
        # æ¨é€åˆ°Gitee
        echo "ğŸ“¤ æ¨é€åˆ°Gitee..."
        git push origin master
        
        echo "ğŸ‰ åŒæ­¥å®Œæˆï¼"
        echo "ğŸ”— æ–‡ä»¶åœ°å€: https://gitee.com/shiwenhua/epg-sync/raw/master/swh123_epg.gz"
